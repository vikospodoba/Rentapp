<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">Страховка</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragment/header :: header}"></div>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-shield-alt me-2"></i>
                        <span th:text="${pageTitle}">Страховка</span>
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Информация об автомобиле -->
                    <div class="alert alert-info mb-4" th:if="${insurance.car != null}">
                        <i class="fas fa-car me-2"></i>
                        <strong>Автомобиль:</strong>
                        <span th:text="${insurance.car.fullName}">Название авто</span>
                    </div>

                    <!-- Форма для новой страховки -->
                    <form th:if="${insurance.id == null}"
                          th:action="@{/insurance}"
                          th:object="${insurance}"
                          method="post">
                        <input type="hidden" name="carId" th:value="${insurance.car.id}">

                        <div class="mb-3">
                            <label for="insuranceCompany" class="form-label">
                                <i class="fas fa-building me-1"></i>Страховая компания
                            </label>
                            <input type="text" class="form-control" id="insuranceCompany"
                                   th:field="*{insuranceCompany}"
                                   th:classappend="${#fields.hasErrors('insuranceCompany')} ? 'is-invalid'"
                                   placeholder="Например: ООО Страхование Плюс" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('insuranceCompany')}"
                                 th:errors="*{insuranceCompany}">Ошибка</div>
                        </div>

                        <div class="mb-3">
                            <label for="policyNumber" class="form-label">
                                <i class="fas fa-file-contract me-1"></i>Номер полиса
                            </label>
                            <input type="text" class="form-control" id="policyNumber"
                                   th:field="*{policyNumber}"
                                   th:classappend="${#fields.hasErrors('policyNumber')} ? 'is-invalid'"
                                   placeholder="Например: TPL-123-2024" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('policyNumber')}"
                                 th:errors="*{policyNumber}">Ошибка</div>
                        </div>

                        <div class="mb-3">
                            <label for="coverageType" class="form-label">
                                <i class="fas fa-check-double me-1"></i>Тип покрытия
                            </label>
                            <select class="form-select" id="coverageType" th:field="*{coverageType}" required>
                                <option value="">Выберите тип покрытия</option>
                                <option value="ОСАГО">ОСАГО</option>
                                <option value="КАСКО">КАСКО</option>
                                <option value="КАСКО + ОСАГО">КАСКО + ОСАГО</option>
                                <option value="Расширенное КАСКО">Расширенное КАСКО</option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('coverageType')}"
                                 th:errors="*{coverageType}">Ошибка</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="startDate" class="form-label">
                                    <i class="fas fa-calendar-alt me-1"></i>Дата начала
                                </label>
                                <input type="date" class="form-control" id="startDate"
                                       th:field="*{startDate}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="endDate" class="form-label">
                                    <i class="fas fa-calendar-check me-1"></i>Дата окончания
                                </label>
                                <input type="date" class="form-control" id="endDate"
                                       th:field="*{endDate}" required>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="premiumAmount" class="form-label">
                                <i class="fas fa-ruble-sign me-1"></i>Страховая премия
                            </label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0.01" class="form-control" id="premiumAmount"
                                       th:field="*{premiumAmount}"
                                       th:classappend="${#fields.hasErrors('premiumAmount')} ? 'is-invalid'"
                                       placeholder="0.00" required>
                                <span class="input-group-text">₽</span>
                            </div>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('premiumAmount')}"
                                 th:errors="*{premiumAmount}">Ошибка</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a th:href="@{/insurance}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Отмена
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Сохранить
                            </button>
                        </div>
                    </form>

                    <!-- Форма для редактирования страховки -->
                    <form th:if="${insurance.id != null}"
                          th:action="@{/insurance/{id}(id=${insurance.id})}"
                          th:object="${insurance}"
                          method="post">

                        <div class="mb-3">
                            <label for="insuranceCompanyEdit" class="form-label">
                                <i class="fas fa-building me-1"></i>Страховая компания
                            </label>
                            <input type="text" class="form-control" id="insuranceCompanyEdit"
                                   th:field="*{insuranceCompany}"
                                   th:classappend="${#fields.hasErrors('insuranceCompany')} ? 'is-invalid'"
                                   placeholder="Например: ООО Страхование Плюс" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('insuranceCompany')}"
                                 th:errors="*{insuranceCompany}">Ошибка</div>
                        </div>

                        <div class="mb-3">
                            <label for="policyNumberEdit" class="form-label">
                                <i class="fas fa-file-contract me-1"></i>Номер полиса
                            </label>
                            <input type="text" class="form-control" id="policyNumberEdit"
                                   th:field="*{policyNumber}"
                                   th:classappend="${#fields.hasErrors('policyNumber')} ? 'is-invalid'"
                                   placeholder="Например: TPL-123-2024" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('policyNumber')}"
                                 th:errors="*{policyNumber}">Ошибка</div>
                        </div>

                        <div class="mb-3">
                            <label for="coverageTypeEdit" class="form-label">
                                <i class="fas fa-check-double me-1"></i>Тип покрытия
                            </label>
                            <select class="form-select" id="coverageTypeEdit" th:field="*{coverageType}" required>
                                <option value="">Выберите тип покрытия</option>
                                <option value="ОСАГО">ОСАГО</option>
                                <option value="КАСКО">КАСКО</option>
                                <option value="КАСКО + ОСАГО">КАСКО + ОСАГО</option>
                                <option value="Расширенное КАСКО">Расширенное КАСКО</option>
                            </select>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('coverageType')}"
                                 th:errors="*{coverageType}">Ошибка</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="startDateEdit" class="form-label">
                                    <i class="fas fa-calendar-alt me-1"></i>Дата начала
                                </label>
                                <input type="date" class="form-control" id="startDateEdit"
                                       th:field="*{startDate}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="endDateEdit" class="form-label">
                                    <i class="fas fa-calendar-check me-1"></i>Дата окончания
                                </label>
                                <input type="date" class="form-control" id="endDateEdit"
                                       th:field="*{endDate}" required>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="premiumAmountEdit" class="form-label">
                                <i class="fas fa-ruble-sign me-1"></i>Страховая премия
                            </label>
                            <div class="input-group">
                                <input type="number" step="0.01" min="0.01" class="form-control" id="premiumAmountEdit"
                                       th:field="*{premiumAmount}"
                                       th:classappend="${#fields.hasErrors('premiumAmount')} ? 'is-invalid'"
                                       placeholder="0.00" required>
                                <span class="input-group-text">₽</span>
                            </div>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('premiumAmount')}"
                                 th:errors="*{premiumAmount}">Ошибка</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a th:href="@{/insurance}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Отмена
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Сохранить изменения
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragment/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
